<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Carboard Map</title>
    <style>
/* Always set the map height explicitly to define the size of the div
 * element that contains the map. */
#map {
	height: 100%;
}
/* Optional: Makes the sample page fill the window. */
html, body {
height: 100%;
margin: 0;
padding: 0;
}
</style>
</head>

<body>
<div id="map"></div>
<script>

function downloadUrl(url,callback) {
 var request = window.ActiveXObject ?
     new ActiveXObject('Microsoft.XMLHTTP') :
     new XMLHttpRequest;

 request.onreadystatechange = function() {
   if (request.readyState == 4) {
     //request.onreadystatechange = doNothing;
     callback(request, request.status);
   }
 };

 request.open('GET', url, true);
 request.send(null);
}


function initMap() {
	var OSU = {
		lat: 44.562854,
     		lng: -123.278977
	};
	var map = new google.maps.Map(document.getElementById('map'), {
		zoom: 10,
		center: OSU
	});
	var OSUmarker = new google.maps.Marker({
		position: OSU,
		map: map,
		title: 'Oregon State University'
	});
	var contentString =
		'<h1 id="firstHeading" class="firstHeading">Oregon State University</h1>'+
		'<div id="bodyContent">'+
		'<p><b>Oregon State University, Corvallis, OR</b></br>' +
                '<img src="http://stat.oregonstate.edu/files/stat7/pic3.jpg" alt="Pic of OSU" height="71" width="106"></br>' +
		'Phone Number: (541)737-1000</br> '+
		'Research-centric public school founded in 1868, with popular engineering &science programs '+
		'<p>Website:<a href="https://oregonstate.edu">oregonstate.edu</a> '+
		'</p>'+
		'</div>'+
		'</div>';
	var OSUinfowindow = new google.maps.InfoWindow({
		content: contentString
	});
	OSUmarker.addListener('click', function() {
		OSUinfowindow.open(map, OSUmarker);
	});
	var bounds = new google.maps.LatLngBounds();
	var icons = {
		recovery: {
			icon: 'http://maps.google.com/mapfiles/ms/micons/recycle.png'
	  	},
		manufacturing: {
			icon: 'https://maps.google.com/mapfiles/kml/pal4/icon47.png'
	       }
	};
	var infowindow = new google.maps.InfoWindow();

    downloadUrl('http://web.engr.oregonstate.edu/~niguang/getData.php?type="cardboard"', function(data) {
      var xml = data.responseXML;
      //console.log(xml);
      var markers = xml.documentElement.getElementsByTagName('marker');
      Array.prototype.forEach.call(markers, function(markerElem) {
        var id = markerElem.getAttribute('id');
        var name = markerElem.getAttribute('name');

        var type = markerElem.getAttribute('type');
        var point = new google.maps.LatLng(
            parseFloat(markerElem.getAttribute('lat')),
            parseFloat(markerElem.getAttribute('lng')));

        var marker = new google.maps.Marker({
          map: map,
          position: point,
          //label: icon.label
        });
        marker.addListener('click', function() {
           OSUinfowindow.open(map, marker);
		   OSUinfowindow.setContent("<div>" + id + "</div>");
	    });
      });
    });
 }
    </script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD_IYVSOyU89P04LDsSj1h5kJcB6DPN8nQ&callback=initMap">
</script>
</body>

</html>
